<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AttendEase</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="app-container">

        <!-- Faculty View -->
        <div id="faculty-view" class="panel">
            <div class="flex-between mb-4">
                <div id="user-name-display" style="font-weight:600"></div>
                <button onclick="logout()"
                    style="background:none; border:none; color:var(--secondary); cursor:pointer;">Logout</button>
            </div>

            <div class="card" id="session-setup">
                <h2>New Session</h2>
                <div class="input-group">
                    <label>Subject</label>
                    <select id="subject">
                        <option value="Java Full Stack">Java Full Stack</option>
                        <option value="Data Structures">Data Structures</option>
                        <option value="Database Systems">Database Systems</option>
                    </select>
                </div>

                <div class="flex-between" style="gap:10px;">
                    <div class="input-group" style="flex:1">
                        <label>Section</label>
                        <select id="section">
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                        </select>
                    </div>
                    <div class="input-group" style="flex:1">
                        <label>Duration</label>
                        <select id="duration">
                            <option value="30">30 Mins</option>
                            <option value="45">45 Mins</option>
                            <option value="60">1 Hour</option>
                            <option value="90">1.5 Hours</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label>Token Type</label>
                    <select id="token-type">
                        <option value="standard">Standard (Scan / ID + Token)</option>
                        <option value="simple">Simple (8-char Token Only)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="mock-location-check" style="width:auto;">
                        <span style="font-size:0.9rem; color:var(--text-muted)">Use Developer/Mock Location (Fixes
                            Access Denied)</span>
                    </label>
                </div>
                <button id="start-session-btn" class="btn btn-primary">Start Session & Generate QR</button>
            </div>

            <div class="card" id="session-active" style="display:none; text-align:center;">
                <h2 style="color:var(--success)">Session Active</h2>
                <p>Scan this QR code to mark attendance</p>
                <div id="qrcode" style="display:flex; justify-content:center; margin:20px 0;"></div>

                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:15px;">
                    <p style="margin-bottom:5px; color:var(--text-muted); font-size:0.9rem;">Manual Token (For Laptops)
                    </p>
                    <h1 id="display-token"
                        style="font-family:monospace; color:var(--primary); letter-spacing:2px; cursor:pointer;"
                        title="Click to Copy"></h1>
                </div>

                <p style="font-size:0.8rem">Session ID: <span id="display-session-id">1</span> (Share if needed)</p>
                <button class="btn btn-secondary" onclick="location.reload()">End Session</button>
            </div>
        </div>

        <!-- Student View -->
        <div id="student-view" class="panel">
            <div class="flex-between mb-4">
                <div id="user-name-display-student" style="font-weight:600">Student Portal</div>
                <button onclick="logout()"
                    style="background:none; border:none; color:var(--secondary); cursor:pointer;">Logout</button>
            </div>

            <div class="card">
                <h2>Mark Attendance</h2>
                <p>Ensure you are in class and location is enabled.</p>

                <div class="flex-center mb-3" style="gap:10px; justify-content: flex-start;">
                    <button class="btn btn-sm active" id="mode-std-btn" onclick="setStudentMode('standard')"
                        style="opacity:1; background:var(--primary); border:none; color:#fff; padding:5px 10px; border-radius:4px; font-size:0.8rem;">Standard</button>
                    <button class="btn btn-sm" id="mode-simple-btn" onclick="setStudentMode('simple')"
                        style="opacity:0.5; background:var(--secondary); border:none; color:#fff; padding:5px 10px; border-radius:4px; font-size:0.8rem;">8-Char
                        Token</button>
                </div>

                <div class="input-group" id="grp-session-id">
                    <label>Session ID</label>
                    <input type="text" id="student-session-id" placeholder="Enter ID from Faculty">
                </div>
                <div class="input-group">
                    <label>Session Token</label>
                    <input type="text" id="student-token" placeholder="Enter Token shown on Screen">
                </div>
                <!-- Mock Location for Students (Laptops) -->
                <div class="input-group">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="student-mock-location" style="width:auto;">
                        <span style="font-size:0.9rem; color:var(--text-muted)">Use Developer/Mock Location (Fixes
                            Access Denied)</span>
                    </label>
                </div>

                <button id="scan-btn" class="btn btn-primary" style="display:none">Scan QR Code</button>
                <button id="manual-mark-btn" class="btn btn-primary">Mark Attendance</button>

                <div class="mt-4">
                    <h3>Recent History</h3>
                    <div id="history-list" style="margin-top:10px; font-size:0.9rem; color:var(--text-muted)">
                        <div style="padding:10px; border-bottom:1px solid var(--border)">Java Full Stack - <span
                                style="color:var(--success)">Present</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="panel">
            <div class="flex-between mb-4">
                <div style="font-weight:600">Admin Dashboard</div>
                <button onclick="logout()"
                    style="background:none; border:none; color:var(--secondary); cursor:pointer;">Logout</button>
            </div>

            <!-- Tabs -->
            <div class="role-selector" style="margin-bottom:20px;">
                <div class="role-btn active" onclick="switchAdminTab('dashboard')">Overview</div>
                <div class="role-btn" onclick="switchAdminTab('users')">Manage Users</div>
            </div>

            <!-- Tab: Dashboard -->
            <div id="admin-tab-dashboard">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
                    <div class="card" style="padding:16px; text-align:center;">
                        <h3 id="stat-students" style="color:var(--primary); font-size:1.5rem">0</h3>
                        <small>Total Students</small>
                    </div>
                    <div class="card" style="padding:16px; text-align:center;">
                        <h3 id="stat-faculty" style="color:var(--secondary); font-size:1.5rem">0</h3>
                        <small>Total Faculty</small>
                    </div>
                    <div class="card" style="padding:16px; text-align:center;">
                        <h3 id="stat-sessions" style="color:var(--success); font-size:1.5rem">0</h3>
                        <small>Active Sessions</small>
                    </div>
                    <div class="card" style="padding:16px; text-align:center;">
                        <h3 id="stat-defaulters" style="color:var(--error); font-size:1.5rem">0</h3>
                        <small>Defaulters</small>
                    </div>
                </div>

                <div class="card">
                    <h3>Analytics</h3>
                    <p>Department-wise Attendance Performance</p>
                    <!-- Mock Chart Bars -->
                    <div style="margin-top:10px;">
                        <div class="flex-between" style="font-size:0.8rem; margin-bottom:4px;"><span>CSE</span>
                            <span>85%</span>
                        </div>
                        <div style="height:8px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                            <div style="width:85%; height:100%; background:var(--primary)"></div>
                        </div>
                    </div>
                    <div style="margin-top:10px;">
                        <div class="flex-between" style="font-size:0.8rem; margin-bottom:4px;"><span>ECE</span>
                            <span>72%</span>
                        </div>
                        <div style="height:8px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                            <div style="width:72%; height:100%; background:var(--secondary)"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Manage Users -->
            <div id="admin-tab-users" style="display:none;">
                <div class="card mb-4" id="user-list-card">
                    <h3>All Users</h3>
                    <div style="max-height:200px; overflow-y:auto; margin-top:10px;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
                            <thead>
                                <tr style="text-align:left; border-bottom:1px solid var(--border)">
                                    <th style="padding:8px; color:var(--text-muted)">Role</th>
                                    <th style="padding:8px; color:var(--text-muted)">Name</th>
                                    <th style="padding:8px; color:var(--text-muted)">Dept</th>
                                    <th style="padding:8px; color:var(--text-muted)">Email</th>
                                </tr>
                            </thead>
                            <tbody id="user-list-body">
                                <!-- Populated via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <h3>Add New User</h3>
                    <form id="create-user-form">
                        <div class="input-group">
                            <label>Role</label>
                            <select id="new-user-role">
                                <option value="STUDENT">Student</option>
                                <option value="FACULTY">Faculty</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Full Name</label>
                            <input type="text" id="new-user-name" placeholder="e.g. Alice Smith" required>
                        </div>
                        <div class="input-group">
                            <label>Department</label>
                            <select id="new-user-dept">
                                <option value="CSE">CSE</option>
                                <option value="IT">IT</option>
                                <option value="ECE">ECE</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Email (Username)</label>
                            <input type="email" id="new-user-email" placeholder="user@test.com" required>
                        </div>
                        <div class="input-group">
                            <label>Password</label>
                            <input type="text" id="new-user-pass" value="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Create User</button>
                    </form>
                </div>
            </div>

        </div>

        <script src="js/app.js"></script>
</body>

</html>